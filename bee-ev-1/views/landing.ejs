<%- include('partials/header') %>
<div class="hero-gradient mb-4">
	<div class="row align-items-center g-4">
		<div class="col-lg-6">
			<div class="mb-3"><span class="badge-soft">Campus Placement Portal</span></div>
			<h1 class="display-4 fw-bold hero-title">Launch Your <span class="brand-highlight">Career from Campus</span></h1>
			<p class="lead hero-subtitle">Track visiting companies, get notified about new drives, and improve your resume with basic ATS-style feedback.</p>
			<div style="min-height: 1rem;"></div>
			<div class="stat-tiles mt-3">
				<div class="stat-tile fade-in-up"><div class="stat-value">10K+</div><div class="stat-label">Companies</div></div>
				<div class="stat-tile fade-in-up" style="animation-delay:.05s"><div class="stat-value">70%</div><div class="stat-label">Faster Hiring</div></div>
				<div class="stat-tile fade-in-up" style="animation-delay:.1s"><div class="stat-value">99.9%</div><div class="stat-label">Uptime</div></div>
			</div>
		</div>
	</div>
</div>

<div class="row g-4">
	<div class="col-md-6">
		<div class="feature-tile fade-in-up">
			<div class="d-flex justify-content-between align-items-start mb-2">
				<div class="feature-icon">üåü</div>
				<span class="badge-popular">New</span>
			</div>
			<h5 class="mb-2">Student Resume & ATS Score</h5>
			<p class="mb-3">Build your resume, get an approximate ATS score for each company, and see missing keywords to improve.</p>
			<div class="d-flex gap-2">
				<% if (currentUser && currentUser.role === 'candidate') { %>
					<a href="/student/resume" class="btn btn-primary-gradient btn-sm btn-pill">Open My Resume</a>
				<% } else { %>
					<a href="/signup" class="btn btn-primary-gradient btn-sm btn-pill">Create Student Account</a>
					<a href="/login" class="btn btn-outline-primary-soft btn-sm btn-pill">Sign In</a>
				<% } %>
			</div>
		</div>
	</div>
	<% if (!currentUser || currentUser.role === 'recruiter') { %>
	<div class="col-md-6">
		<div class="feature-tile fade-in-up" style="animation-delay:.05s">
			<div class="feature-icon mb-2">üîç</div>
			<h5 class="mb-2">Upcoming Companies</h5>
			<p class="mb-3">Placement team can add company drives; students get notified when new companies are added.</p>
			<div class="d-flex gap-2">
				<% if (currentUser && currentUser.role === 'recruiter') { %>
					<a href="/admin/companies" class="btn btn-primary-gradient btn-sm btn-pill">Manage Companies</a>
				<% } else { %>
					<a href="/signup" class="btn btn-primary-gradient btn-sm btn-pill">Placement / Admin Sign up</a>
				<% } %>
				<a href="/signup" class="btn btn-outline-primary-soft btn-sm btn-pill">Get Started</a>
			</div>
		</div>
	</div>
	<% } else { %>
	<div class="col-md-6">
		<div class="feature-tile fade-in-up" style="animation-delay:.05s">
			<div class="feature-icon mb-2">üìä</div>
			<h5 class="mb-2">Student Dashboard</h5>
			<p class="mb-3">Track visiting companies, your notifications, and your resume ATS score in one place.</p>
			<div class="d-flex gap-2">
				<a href="/student/home" class="btn btn-primary-gradient btn-sm btn-pill">Student Home</a>
				<a href="/student/resume" class="btn btn-outline-primary-soft btn-sm btn-pill">My Resume</a>
			</div>
		</div>
	</div>
	<% } %>
</div>

<!-- Tech News Section (Hacker News API) -->
<hr class="my-5" />
<div class="row g-4">
	<div class="col-12">
		<div class="feature-tile fade-in-up">
			<div class="d-flex justify-content-between align-items-center mb-2">
				<div class="d-flex align-items-center gap-2">
					<span class="feature-icon">üì∞</span>
					<div>
						<h5 class="mb-0">Latest Tech News</h5>
						<small class="text-muted">Powered by Hacker News (top stories)</small>
					</div>
				</div>
				<span class="badge bg-primary-subtle text-primary">Real-time</span>
			</div>
			<p class="mb-3 text-muted">Top community-voted stories from the global tech community. Click a card to read the full article.</p>

			<!-- Filters -->
			<div class="d-flex flex-wrap gap-2 mb-2 align-items-center">
				<div class="input-group input-group-sm" style="max-width: 260px;">
					<span class="input-group-text"><i class="bi bi-search"></i></span>
					<input type="text" id="tech-news-search" class="form-control" placeholder="Filter by keyword (e.g. AI, JS)" />
				</div>
				<button type="button" class="btn btn-outline-primary-soft btn-sm ms-auto" id="tech-news-refresh">
					<i class="bi bi-arrow-clockwise"></i>
					<span class="d-none d-sm-inline">Refresh</span>
				</button>
			</div>
			<div class="d-flex justify-content-between align-items-center mb-2">
				<small class="text-muted" id="tech-news-last-updated">Last updated: --:--</small>
				<small class="text-muted">Search top Hacker News stories</small>
			</div>

			<div id="tech-news" class="row row-cols-1 row-cols-md-2 g-3">
				<div class="col" id="tech-news-loading">
					<div class="card border-0 shadow-sm h-100">
						<div class="card-body d-flex align-items-center justify-content-center text-muted small">
							<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
							Loading latest tech news...
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Demo Modal -->
<div class="modal fade" id="demoModal" tabindex="-1">
	<div class="modal-dialog modal-dialog-centered modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">TalentPipeline Demo</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<div class="ratio ratio-16x9">
					<iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ" title="Demo" allowfullscreen></iframe>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
  (function () {
    var container = document.getElementById('tech-news');
    var loadingEl = document.getElementById('tech-news-loading');
    var searchInput = document.getElementById('tech-news-search');
    var refreshBtn = document.getElementById('tech-news-refresh');
    var lastUpdatedEl = document.getElementById('tech-news-last-updated');

    if (!container) return;

    var allStories = [];

    function formatUnixTime(unixTime) {
      if (!unixTime) return '';
      try {
        var d = new Date(unixTime * 1000);
        return d.toLocaleString();
      } catch (_) {
        return '';
      }
    }

    function updateLastUpdated() {
      if (!lastUpdatedEl) return;
      var now = new Date();
      lastUpdatedEl.textContent = 'Last updated: ' + now.toLocaleTimeString();
    }

    function showError(message) {
      container.innerHTML = '<div class="col"><div class="alert alert-warning mb-0">' +
        (message || 'Unable to load tech news right now.') +
        '</div></div>';
    }

    function renderStories(filterText) {
      var term = (filterText || '').toLowerCase().trim();
      var stories = allStories.slice();

      if (term) {
        stories = stories.filter(function (s) {
          var text = ((s.title || '') + ' ' + (s.by || '')).toLowerCase();
          return text.indexOf(term) !== -1;
        });
      }

      if (!stories.length) {
        container.innerHTML = '<div class="col"><div class="alert alert-info mb-0">' +
          (term ? 'No stories match your search.' : 'No stories available right now.') +
          '</div></div>';
        return;
      }

      container.innerHTML = '';

      stories.forEach(function (story, index) {
        var col = document.createElement('div');
        col.className = 'col';

        var card = document.createElement('div');
        card.className = 'card border-0 shadow-sm h-100 hover-lift';

        var body = document.createElement('div');
        body.className = 'card-body d-flex flex-column';

        var topRow = document.createElement('div');
        topRow.className = 'd-flex justify-content-between align-items-center mb-2';

        var rankBadge = document.createElement('span');
        rankBadge.className = 'badge bg-primary-subtle text-primary';
        rankBadge.textContent = '#' + (index + 1);

        var scoreBadge = document.createElement('span');
        scoreBadge.className = 'badge bg-warning-subtle text-warning-emphasis';
        scoreBadge.textContent = (story.score || 0) + ' points';

        topRow.appendChild(rankBadge);
        topRow.appendChild(scoreBadge);

        var titleLink = document.createElement('a');
        titleLink.className = 'fw-semibold mb-1 text-decoration-none stretched-link';
        titleLink.target = '_blank';
        titleLink.rel = 'noopener';
        titleLink.textContent = story.title || 'Untitled story';
        titleLink.href = story.url || ('https://news.ycombinator.com/item?id=' + story.id);

        var meta = document.createElement('div');
        meta.className = 'd-flex justify-content-between align-items-center mt-2';

        var leftMeta = document.createElement('small');
        leftMeta.className = 'text-muted';
        leftMeta.textContent = (story.by || 'unknown');

        var rightMeta = document.createElement('small');
        rightMeta.className = 'text-muted';
        rightMeta.textContent = story.time ? formatUnixTime(story.time) : '';

        meta.appendChild(leftMeta);
        meta.appendChild(rightMeta);

        body.appendChild(topRow);
        body.appendChild(titleLink);
        body.appendChild(meta);

        card.appendChild(body);
        col.appendChild(card);
        container.appendChild(col);
      });
    }

    async function loadTopStories() {
      try {
        if (loadingEl) {
          loadingEl.style.display = '';
        }

        var res = await fetch('https://hacker-news.firebaseio.com/v0/topstories.json');
        if (!res.ok) {
          showError('Unable to load tech news right now.');
          return;
        }

        var ids = await res.json();
        var topIds = (ids || []).slice(0, 20);

        var storyPromises = topIds.map(function (id) {
          return fetch('https://hacker-news.firebaseio.com/v0/item/' + id + '.json')
            .then(function (r) { return r.ok ? r.json() : null; })
            .catch(function () { return null; });
        });

        var items = await Promise.all(storyPromises);
        allStories = items.filter(function (item) {
          return item && item.type === 'story';
        });

        updateLastUpdated();
        renderStories(searchInput ? searchInput.value : '');
      } catch (err) {
        console.error('Hacker News load error:', err);
        showError('Unable to load tech news right now.');
      } finally {
        if (loadingEl) {
          loadingEl.style.display = 'none';
        }
      }
    }

    if (searchInput) {
      var debounceTimer = null;
      searchInput.addEventListener('input', function (e) {
        clearTimeout(debounceTimer);
        var value = e.target.value;
        debounceTimer = setTimeout(function () {
          renderStories(value);
        }, 200);
      });
    }

    if (refreshBtn) {
      refreshBtn.addEventListener('click', function () {
        loadTopStories();
      });
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadTopStories);
    } else {
      loadTopStories();
    }
  })();
</script>

<%- include('partials/footer') %>
