<%- include('../partials/header') %>
<div class="row g-4">
  <div class="col-lg-7">
    <h3 class="mb-3">ATS Resume Score Checker</h3>
    <p class="text-muted">Upload your Word (.docx) resume and pick a company to get an approximate ATS-style match score.</p>

    <% if (resume && resume.fileOriginalName) { %>
      <div class="alert alert-success py-2">
        <strong>Last uploaded:</strong> <%= resume.fileOriginalName %>
        <% if (resume.uploadedAt) { %>
          <span class="text-muted"> (on <%= new Date(resume.uploadedAt).toLocaleString() %>)</span>
        <% } %>
        <% if (resume.fileUrl) { %>
          <span class="ms-2">
            <a href="<%= resume.fileUrl %>" target="_blank" class="link-light text-decoration-underline">
              View / download
            </a>
          </span>
        <% } %>
      </div>
    <% } %>

    <form method="post" action="/student/resume/upload" enctype="multipart/form-data" class="mt-2">
      <input type="hidden" name="_csrf" value="<%= csrfToken %>">
      <div class="mb-3">
        <label class="form-label">Resume File (DOCX only)</label>
        <input type="file" class="form-control" name="resumeFile" accept=".docx" required>
      </div>
      <div class="mb-3">
        <label class="form-label">Company for ATS check</label>
        <select class="form-select" name="atsCompanyId" required>
          <option value="">-- Select company --</option>
          <% companies.forEach(function(c) { %>
            <option value="<%= c._id %>" <%= (selectedCompanyId && selectedCompanyId.toString() === c._id.toString()) ? 'selected' : '' %>>
              <%= c.name %> - <%= c.role %>
            </option>
          <% }) %>
        </select>
      </div>
      <button class="btn btn-primary">Upload & Check ATS</button>
    </form>
  </div>

  <div class="col-lg-5">
    <h4 class="mb-3">ATS Score & Uploaded Resume</h4>
    <% if (atsScore === null) { %>
      <div class="alert alert-info">Upload a DOCX resume and select a company to see your approximate ATS match.</div>
    <% } else { %>
      <div class="card mb-3">
        <div class="card-body text-center">
          <h5 class="card-title mb-3">Approximate ATS Match</h5>
          <div style="font-size: 2.5rem; font-weight: 800; color: #4c63d2;">
            <%= atsScore %>%
          </div>
          <% if (typeof atsExplanation !== 'undefined' && atsExplanation) { %>
            <p class="mt-2 text-muted"><%= atsExplanation %></p>
          <% } else { %>
            <p class="mt-2 text-muted">
              Higher is better. This is a simple keyword-based estimate.
            </p>
          <% } %>
        </div>
      </div>
    <% } %>

    <% if (resume && resume.fileOriginalName) { %>
      <div class="card mb-3">
        <div class="card-body">
          <h6 class="mb-2">Uploaded Resume</h6>
          <p class="mb-1">
            <strong>File:</strong> <%= resume.fileOriginalName %>
            <% if (resume.uploadedAt) { %>
              <span class="text-muted"> (on <%= new Date(resume.uploadedAt).toLocaleString() %>)</span>
            <% } %>
          </p>
          <% if (resume.fileUrl) { %>
            <a href="<%= resume.fileUrl %>" target="_blank" class="btn btn-sm btn-outline-primary">View / download resume</a>
          <% } else { %>
            <p class="text-muted mb-0">File stored but direct link is not available.</p>
          <% } %>
        </div>
      </div>
    <% } %>

    <div class="card">
      <div class="card-body">
        <h6 class="mb-2">Missing / Weak Keywords</h6>
        <% if (!atsMissingKeywords || atsMissingKeywords.length === 0) { %>
          <p class="text-muted mb-0">Great! Your resume already covers most important keywords for this company.</p>
        <% } else { %>
          <p class="text-muted">Consider naturally adding some of these terms if they truly match your skills:</p>
          <div class="d-flex flex-wrap gap-2">
            <% atsMissingKeywords.forEach(function(word) { %>
              <span class="badge bg-secondary"><%= word %></span>
            <% }) %>
          </div>
        <% } %>
      </div>
    </div>
  </div>
</div>
<%- include('../partials/footer') %>
