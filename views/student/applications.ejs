<%- include('../partials/header') %>
<h3 class="mb-3">My Applications</h3>

<div class="card mb-3 hover-lift glass-soft">
  <div class="card-body">
    <form class="row g-2 align-items-end" method="get" action="/student/applications">
      <div class="col-md-4">
        <label class="form-label">Status</label>
        <select name="status" class="form-select">
          <option value="" <%= !filters || !filters.status ? 'selected' : '' %>>All</option>
          <option value="applied" <%= filters && filters.status === 'applied' ? 'selected' : '' %>>Applied</option>
          <option value="shortlisted" <%= filters && filters.status === 'shortlisted' ? 'selected' : '' %>>Shortlisted</option>
          <option value="rejected" <%= filters && filters.status === 'rejected' ? 'selected' : '' %>>Rejected</option>
          <option value="selected" <%= filters && filters.status === 'selected' ? 'selected' : '' %>>Selected</option>
        </select>
      </div>
      <div class="col-md-4">
        <label class="form-label">Sort by</label>
        <select name="sort" class="form-select">
          <option value="newest" <%= !filters || filters.sort === 'newest' ? 'selected' : '' %>>Newest first</option>
          <option value="oldest" <%= filters && filters.sort === 'oldest' ? 'selected' : '' %>>Oldest first</option>
        </select>
      </div>
      <div class="col-md-4">
        <button class="btn btn-primary mt-3">Apply Filters</button>
      </div>
    </form>
  </div>
</div>

<% if (!applications || applications.length === 0) { %>
  <div class="alert alert-info">You have not applied to any companies yet.</div>
<% } else { %>
  <table class="table table-striped align-middle">
    <thead>
      <tr>
        <th>Company</th>
        <th>Role</th>
        <th>Visit Date</th>
        <th>Status</th>
        <th>Applied On</th>
      </tr>
    </thead>
    <tbody>
      <% applications.forEach(function(a) { %>
        <tr>
          <td>
            <% if (a.company) { %>
              <a href="/companies/<%= a.company._id %>"><%= a.company.name %></a>
            <% } else { %>
              Unknown
            <% } %>
          </td>
          <td><%= a.company ? a.company.role : '-' %></td>
          <td><%= a.company && a.company.visitDate ? new Date(a.company.visitDate).toLocaleDateString() : '-' %></td>
          <td class="text-capitalize"><%= a.status %></td>
          <td><%= new Date(a.createdAt).toLocaleDateString() %></td>
        </tr>
      <% }) %>
    </tbody>
  </table>
<% } %>
<%- include('../partials/footer') %>
